<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calendário Escolar 2026</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM (Versões Estáveis) -->
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- PDF Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    
    <style>
      body {
        font-family: 'Roboto', sans-serif;
        background-color: #f0f4f8;
      }
      .print-exact {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <!-- CÓDIGO REACT -->
    <script type="text/babel" data-presets="typescript,react">
      (function() { // Wrap in IIFE to prevent global scope pollution
        const { useState, useEffect, useMemo, useRef } = React;
        
        // --- 0. ÍCONES (SVG In-line para evitar erros de biblioteca externa) ---
        const Icon = ({ size = 24, className = "", children }) => (
          <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={`lucide ${className}`}>
            {children}
          </svg>
        );

        const CloseIcon = (props) => <Icon {...props}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></Icon>;
        const Info = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></Icon>;
        const AlertTriangle = (props) => <Icon {...props}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></Icon>;
        const CalendarDays = (props) => <Icon {...props}><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/><path d="M8 14h.01"/><path d="M12 14h.01"/><path d="M16 14h.01"/><path d="M8 18h.01"/><path d="M12 18h.01"/><path d="M16 18h.01"/></Icon>;
        const TrendingUp = (props) => <Icon {...props}><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></Icon>;
        const Loader2 = (props) => <Icon {...props}><path d="M21 12a9 9 0 1 1-6.219-8.56"/></Icon>;
        const FileDown = (props) => <Icon {...props}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="M12 18v-6"/><path d="m9 15 3 3 3-3"/></Icon>;
        // Added FileCode icon for the Offline App button to match the visual style of a file action
        const FileCode = (props) => <Icon {...props}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="m10 13-2 2 2 2"/><path d="m14 17 2-2-2-2"/></Icon>;
        const Download = (props) => <Icon {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></Icon>;
        const Flag = (props) => <Icon {...props}><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" x2="4" y1="22" y2="15"/></Icon>;
        const Calendar = (props) => <Icon {...props}><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></Icon>;
        const BookOpen = (props) => <Icon {...props}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 1-4 4v14a3 3 0 0 0 3-3h7z"/></Icon>;
        const Users = (props) => <Icon {...props}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></Icon>;
        const Star = (props) => <Icon {...props}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></Icon>;
        const GraduationCap = (props) => <Icon {...props}><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></Icon>;
        const AlertCircle = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></Icon>;


        // --- 1. DEFINIÇÃO DE TIPOS E CONSTANTES ---
        
        // URL da LOGO ATUALIZADA - Link direto
        const LOGO_URL = "https://lh7-rt.googleusercontent.com/docsz/AD_4nXe9tHTkXEaioDNQWbrxihdbawB9Atv96l6-doZHveAJo-wBfBehXKlJVk4ytGblY6_7XlUh0HsVGrTVCQcl3zjy7M9eHTDLXgJYFGhZcR8xTBTX9zp3u5847UJYuf0-_oPqjz1odg?key=Sgq5N3Kc0KCKK9iCpfkjmA"; 
        
        // Texto de Créditos
        const CREDITS_TEXT = "Desenvolvido por Raí Douglas Pinheiro Franco / Discente do Curso Técnico em Administração - IDEP/RO";

        const EventType = {
          HOLIDAY: 'HOLIDAY',
          RECESS: 'RECESS',
          START_END: 'START_END',
          PLANNING: 'PLANNING',
          MEETING: 'MEETING',
          EVENT: 'EVENT',
          EXAM: 'EXAM',
        };

        const YEAR = 2026;

        const MONTHS = [
          { name: 'JANEIRO', days: 31, startDay: 4, colorTheme: 'bg-orange-500' },
          { name: 'FEVEREIRO', days: 28, startDay: 0, colorTheme: 'bg-blue-600' },
          { name: 'MARÇO', days: 31, startDay: 0, colorTheme: 'bg-indigo-900' },
          { name: 'ABRIL', days: 30, startDay: 3, colorTheme: 'bg-orange-500' },
          { name: 'MAIO', days: 31, startDay: 5, colorTheme: 'bg-green-600' },
          { name: 'JUNHO', days: 30, startDay: 1, colorTheme: 'bg-blue-600' },
          { name: 'JULHO', days: 31, startDay: 3, colorTheme: 'bg-orange-500' },
          { name: 'AGOSTO', days: 31, startDay: 6, colorTheme: 'bg-green-600' },
          { name: 'SETEMBRO', days: 30, startDay: 2, colorTheme: 'bg-red-600' },
          { name: 'OUTUBRO', days: 31, startDay: 4, colorTheme: 'bg-orange-500' },
          { name: 'NOVEMBRO', days: 30, startDay: 0, colorTheme: 'bg-orange-600' },
          { name: 'DEZEMBRO', days: 31, startDay: 2, colorTheme: 'bg-red-600' },
        ];

        const EVENTS = [
          { month: 0, day: 1, type: EventType.HOLIDAY, description: "Confraternização Universal" },
          { month: 0, day: 3, type: EventType.RECESS, description: "Fim do recesso/revezamento" },
          { month: 0, day: 5, type: EventType.EVENT, description: "Abertura Cursos Técnicos" },
          { month: 0, day: 13, type: EventType.PLANNING, description: "Início avaliação docente" },
          { month: 0, day: 19, type: EventType.MEETING, description: "Reunião Pedagógica (Início)" },
          { month: 0, day: 20, type: EventType.MEETING, description: "Reunião Pedagógica" },
          { month: 0, day: 21, type: EventType.MEETING, description: "Reunião Pedagógica" },
          { month: 0, day: 22, type: EventType.MEETING, description: "Reunião Pedagógica" },
          { month: 0, day: 23, type: EventType.MEETING, description: "Reunião Pedagógica (Fim)" },
          { month: 0, day: 24, type: EventType.EVENT, description: "PSE - Vestibular Indígenas/Quilombolas" },
          { month: 0, day: 26, type: EventType.START_END, description: "Início das Aulas" },
          { month: 0, day: 30, type: EventType.RECESS, description: "Fim das férias acadêmicas" },
          { month: 1, day: 2, type: EventType.HOLIDAY, description: "Nossa Senhora dos Navegantes (Porto Velho)" },
          { month: 1, day: 13, type: EventType.PLANNING, description: "Limite envio ofertas 2026/1" },
          { month: 1, day: 16, type: EventType.RECESS, description: "Recesso + Carnaval" },
          { month: 1, day: 17, type: EventType.RECESS, description: "Recesso + Carnaval" },
          { month: 3, day: 3, type: EventType.HOLIDAY, description: "Paixão de Cristo" },
          { month: 3, day: 21, type: EventType.HOLIDAY, description: "Tiradentes" },
          { month: 4, day: 1, type: EventType.HOLIDAY, description: "Dia do Trabalho" },
          { month: 4, day: 8, type: EventType.EVENT, description: "Dia do Profissional Marketing/E-Turismo" },
          { month: 4, day: 24, type: EventType.HOLIDAY, description: "Nossa Senhora Auxiliadora (Padroeira)" },
          { month: 5, day: 3, type: EventType.EVENT, description: "Dia do Profissional de RH" },
          { month: 5, day: 4, type: EventType.HOLIDAY, description: "Corpus Christi" },
          { month: 5, day: 6, type: EventType.EVENT, description: "Dia da Logística" },
          { month: 5, day: 18, type: EventType.HOLIDAY, description: "Dia do Evangélico (RO)" },
          { month: 5, day: 19, type: EventType.EVENT, description: "Jogo do Brasil (Copa)" },
          { month: 5, day: 24, type: EventType.EVENT, description: "Jogo do Brasil (Copa)" },
          { month: 6, day: 8, type: EventType.EXAM, description: "Início Avaliação Cursos" },
          { month: 6, day: 12, type: EventType.EXAM, description: "Fim Avaliação Cursos" },
          { month: 6, day: 15, type: EventType.EVENT, description: "Formatura Técnicos" },
          { month: 6, day: 16, type: EventType.MEETING, description: "Reunião Pedagógica IDEP" },
          { month: 6, day: 19, type: EventType.MEETING, description: "Fim Reunião Pedagógica" },
          { month: 6, day: 20, type: EventType.START_END, description: "Retorno do Recesso" },
          { month: 8, day: 7, type: EventType.HOLIDAY, description: "Independência do Brasil" },
          { month: 8, day: 14, type: EventType.EVENT, description: "Semana Ed. Profissional" },
          { month: 8, day: 18, type: EventType.EVENT, description: "Fim Semana Ed. Profissional" },
          { month: 8, day: 30, type: EventType.EVENT, description: "Dia do Secretário" },
          { month: 9, day: 2, type: EventType.RECESS, description: "Criação do Município (Porto Velho)" },
          { month: 9, day: 4, type: EventType.EVENT, description: "Dia do Técnico Seg. Trabalho" },
          { month: 9, day: 12, type: EventType.HOLIDAY, description: "Nossa Senhora Aparecida" },
          { month: 9, day: 27, type: EventType.EVENT, description: "Dia do Engenheiro Civil" },
          { month: 10, day: 2, type: EventType.HOLIDAY, description: "Finados" },
          { month: 10, day: 15, type: EventType.HOLIDAY, description: "Proclamação da República" },
          { month: 10, day: 20, type: EventType.HOLIDAY, description: "Consciência Negra" },
          { month: 11, day: 18, type: EventType.START_END, description: "Último dia letivo" },
          { month: 11, day: 25, type: EventType.HOLIDAY, description: "Natal" },
        ];

        const LEGEND_ITEMS = [
          { type: EventType.START_END, label: "Início / Fim Ano / Semestre", colorClass: "bg-teal-500", icon: <Flag size={20} className="text-white" /> },
          { type: EventType.HOLIDAY, label: "Feriado Nacional / Estadual / Municipal", colorClass: "bg-red-500", icon: <Calendar size={20} className="text-white" /> },
          { type: EventType.RECESS, label: "Férias / Recesso / Ponto Facultativo", colorClass: "bg-pink-400", icon: <Star size={20} className="text-white" /> },
          { type: EventType.PLANNING, label: "Planejamento / Pedagógico", colorClass: "bg-yellow-400", icon: <BookOpen size={20} className="text-white" /> },
          { type: EventType.MEETING, label: "Reunião Pedagógica", colorClass: "bg-blue-400", icon: <Users size={20} className="text-white" /> },
          { type: EventType.EVENT, label: "Eventos / Datas Comemorativas", colorClass: "bg-indigo-400", icon: <GraduationCap size={20} className="text-white" /> },
          { type: EventType.EXAM, label: "Avaliações", colorClass: "bg-purple-500", icon: <AlertCircle size={20} className="text-white" /> },
        ];

        // --- 2. UTILIDADES ---

        const getWeekDayName = (year, month, day) => {
          const date = new Date(year, month, day);
          const str = date.toLocaleDateString('pt-BR', { weekday: 'long' });
          return str.toUpperCase();
        };

        const getLegendLabel = (type) => {
          const item = LEGEND_ITEMS.find(i => i.type === type);
          return item ? item.label : '';
        };

        const getEventColorStyles = (type) => {
            switch (type) {
              case EventType.HOLIDAY: return "bg-red-500 text-white";
              case EventType.START_END: return "bg-teal-600 text-white";
              case EventType.RECESS: return "bg-pink-500 text-white";
              case EventType.PLANNING: return "bg-yellow-500 text-white";
              case EventType.MEETING: return "bg-blue-500 text-white";
              case EventType.EXAM: return "bg-purple-600 text-white";
              case EventType.EVENT: return "bg-indigo-500 text-white";
              default: return "bg-gray-500 text-white";
            }
        };

        const getEventBadgeStyles = (type) => {
            switch (type) {
              case EventType.HOLIDAY: return "bg-red-500 text-white";
              case EventType.START_END: return "bg-teal-600 text-white";
              case EventType.RECESS: return "bg-pink-400 text-white";
              case EventType.PLANNING: return "bg-yellow-400 text-slate-900";
              case EventType.MEETING: return "bg-blue-500 text-white";
              case EventType.EXAM: return "bg-purple-500 text-white";
              case EventType.EVENT: return "bg-indigo-500 text-white";
              default: return "bg-gray-500 text-white";
            }
        }

        // --- 3. COMPONENTES REACT ---

        const MiniDayCell = ({ day, monthIndex, events, isPdfMode = false }) => {
          const cellHeight = 'h-8'; 
          const bubbleSize = 'w-7 h-7 shadow-sm';
          const textSize = 'text-xs';
          const baseTextClass = 'text-slate-700 font-semibold';

          if (day === null) {
            return <div className={`${cellHeight} w-full`}></div>;
          }

          const dayEvents = events.filter(e => e.month === monthIndex && e.day === day);
          
          const priorityOrder = [
            EventType.HOLIDAY, 
            EventType.START_END, 
            EventType.RECESS, 
            EventType.PLANNING, 
            EventType.EXAM, 
            EventType.MEETING, 
            EventType.EVENT
          ];
          
          const mainEvent = dayEvents.sort((a, b) => 
            priorityOrder.indexOf(a.type) - priorityOrder.indexOf(b.type)
          )[0];

          let bgClass = "";
          let textClass = baseTextClass;
          let shapeClass = "";

          if (mainEvent) {
            textClass = "text-white font-bold";
            const roundedFull = "rounded-full";
            const roundedMd = "rounded-md";

            shapeClass = `${roundedFull} ${bubbleSize} flex items-center justify-center mx-auto`;

            switch (mainEvent.type) {
              case EventType.HOLIDAY: bgClass = "bg-red-500"; break;
              case EventType.START_END: 
                bgClass = "bg-teal-500"; 
                shapeClass = `${roundedMd} ${bubbleSize} flex items-center justify-center mx-auto`;
                break;
              case EventType.RECESS: bgClass = "bg-pink-400"; break;
              case EventType.PLANNING: 
                bgClass = "bg-yellow-400"; 
                textClass = "text-slate-800 font-bold";
                break;
              case EventType.MEETING: bgClass = "bg-blue-400"; break;
              case EventType.EXAM: bgClass = "bg-purple-500"; break;
              case EventType.EVENT: bgClass = "bg-indigo-400"; break;
            }
          } else {
              shapeClass = `${bubbleSize} flex items-center justify-center mx-auto`;
          }
          
          return (
            <div className={`flex justify-center items-center ${cellHeight} relative group cursor-default`}>
              <div className={`${bgClass} ${textClass} ${shapeClass} ${textSize} z-10 transition-transform ${!isPdfMode ? 'hover:scale-110' : ''} leading-none`}>
                {day}
              </div>
            </div>
          );
        };

        const MonthCard = ({ monthIndex, monthData, onClick, id, isPdfMode = false }) => {
          const weeks = useMemo(() => {
            const days = [];
            for (let i = 0; i < monthData.startDay; i++) days.push(null);
            for (let i = 1; i <= monthData.days; i++) days.push(i);
            const chunks = [];
            for (let i = 0; i < days.length; i += 7) chunks.push(days.slice(i, i + 7));
            return chunks;
          }, [monthData]);

          const workDays = useMemo(() => {
            let count = 0;
            for(let d=1; d<=monthData.days; d++) {
                const date = new Date(YEAR, monthIndex, d);
                const dayOfWeek = date.getDay();
                const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
                const isHoliday = EVENTS.some(e => e.month === monthIndex && e.day === d && e.type === EventType.HOLIDAY);
                const isRecess = EVENTS.some(e => e.month === monthIndex && e.day === d && e.type === EventType.RECESS);
                if (!isWeekend && !isHoliday && !isRecess) count++;
            }
            return count;
          }, [monthData, monthIndex]);

          const cardPadding = 'p-1'; 
          const headerHeight = 'py-2 px-4';
          const titleSize = 'text-sm font-bold';
          const subtitleSize = 'text-[10px] px-2 py-0.5';
          const dayHeaderSize = 'text-[10px] py-1.5';
          const gridGap = 'gap-y-1';

          return (
            <div 
              id={id}
              className={`bg-white rounded-xl overflow-hidden shadow-sm border border-slate-200 flex flex-col h-full ${!isPdfMode ? 'hover:shadow-lg hover:-translate-y-0.5 transition-all duration-200 cursor-pointer' : ''} group relative`}
              onClick={onClick}
            >
              <div className={`${monthData.colorTheme} text-white ${headerHeight} flex justify-between items-center`}>
                <span className={`uppercase tracking-wide ${!isPdfMode ? 'group-hover:scale-105 transition-transform' : ''} ${titleSize}`}>{monthData.name}</span>
                <span className={`${subtitleSize} bg-white/20 rounded-full font-medium`}>{workDays} dias letivos</span>
              </div>
              
              <div className="grid grid-cols-7 bg-slate-50 border-b border-slate-100">
                {['D', 'S', 'T', 'Q', 'Q', 'S', 'S'].map((d, i) => (
                  <div key={i} className={`text-center font-bold ${dayHeaderSize} ${i === 0 || i === 6 ? 'text-red-500' : 'text-slate-500'}`}>
                    {d}
                  </div>
                ))}
              </div>

              <div className={`${cardPadding} flex-grow flex flex-col justify-start gap-1 bg-white`}>
                {weeks.map((week, i) => (
                  <div key={i} className={`grid grid-cols-7 ${gridGap}`}>
                    {week.map((day, j) => (
                      <MiniDayCell key={j} day={day} monthIndex={monthIndex} events={EVENTS} isPdfMode={isPdfMode} />
                    ))}
                  </div>
                ))}
              </div>
            </div>
          );
        };

        const ExpandedDayCard = ({ day, monthIndex, events, themeColorClass, isPdfMode }) => {
          // No mobile, escondemos dias vazios (padding)
          if (day === null) return <div className="hidden md:block"></div>;

          const dayEvents = events.filter(e => e.month === monthIndex && e.day === day);
          const textColorClass = themeColorClass.replace('bg-', 'text-');

          const dayNumberClass = 'text-2xl mb-2';
          const containerPadding = 'p-2';
          // No mobile, altura mínima é automática para não ocupar espaço desnecessário
          const minHeight = 'min-h-0 md:min-h-[140px]'; 

          const eventWrapperClass = 'px-2 py-1.5 rounded';
          const eventLabelClass = 'text-[9px] mb-0.5 pb-0.5 border-white/20';
          const eventDescClass = 'text-[10px] leading-tight font-medium';
          const gapClass = 'gap-1';

          // Get weekday name
          const weekDayName = getWeekDayName(YEAR, monthIndex, day);

          return (
            <div className={`bg-white rounded-lg border border-slate-400 flex flex-col relative overflow-hidden h-full ${containerPadding} ${minHeight}`}>
              <div className="flex md:flex-col items-baseline md:items-start gap-2 md:gap-0 mb-1 md:mb-0">
                <span className={`font-bold ${textColorClass} ${dayNumberClass} mb-0`}>
                  {day}
                </span>
                <span className="md:hidden text-sm font-semibold text-slate-400 uppercase">
                  {weekDayName}
                </span>
              </div>
              
              <div className={`flex flex-col w-full ${gapClass}`}>
                {dayEvents.map((event, idx) => (
                  <div 
                    key={idx} 
                    className={`w-full ${getEventBadgeStyles(event.type)} ${eventWrapperClass}`}
                  >
                    <div className={`font-bold uppercase opacity-90 tracking-wider border-b ${eventLabelClass}`}>
                        {getLegendLabel(event.type)}
                    </div>
                    <div className={eventDescClass}>
                        {event.description}
                    </div>
                  </div>
                ))}
              </div>
            </div>
          );
        };

        const ExpandedMonthView = ({ monthIndex, monthData, onClose, isPdfMode = false }) => {
          const weeks = useMemo(() => {
            const days = [];
            for (let i = 0; i < monthData.startDay; i++) days.push(null);
            for (let i = 1; i <= monthData.days; i++) days.push(i);
            const chunks = [];
            for (let i = 0; i < days.length; i += 7) chunks.push(days.slice(i, i + 7));
            return chunks;
          }, [monthData]);

          const Wrapper = isPdfMode ? React.Fragment : 'div';
          const wrapperProps = isPdfMode ? {} : {
            className: "fixed inset-0 z-50 bg-black/40 backdrop-blur-sm overflow-y-auto pt-4 px-4 pb-4 animate-in fade-in duration-200"
          };

          const titleClass = 'text-2xl md:text-4xl';
          const yearClass = 'text-xl md:text-2xl';
          const weekdayClass = 'text-sm mb-4';
          const weekdayGap = 'gap-3';
          const headerPadding = 'px-4 py-4 md:px-8 md:py-6';
          const bodyPadding = 'p-4 md:p-8';

          return (
            <Wrapper {...wrapperProps}>
                <div 
                  className={`bg-white w-full ${isPdfMode ? 'h-full' : 'container mx-auto'} rounded-xl shadow-2xl border border-slate-400 overflow-hidden flex flex-col ${isPdfMode ? '' : 'animate-in zoom-in-95 duration-200'} md:h-auto h-full`}
                  onClick={(e) => e.stopPropagation()}
                >
                  <div className={`${monthData.colorTheme} text-white ${headerPadding} flex items-center justify-between shrink-0 relative shadow-md z-10`}>
                      <div className="flex items-baseline gap-2 md:gap-4">
                          <h1 className={`${titleClass} font-black uppercase tracking-wide`}>
                            {monthData.name}
                          </h1>
                          <span className={`${yearClass} font-light opacity-80`}>
                            {YEAR}
                          </span>
                      </div>

                      <button 
                          onClick={!isPdfMode ? onClose : undefined}
                          className={`p-2 bg-white/20 hover:bg-white/30 rounded-full transition-colors ${isPdfMode ? 'cursor-default' : 'cursor-pointer'}`}
                          aria-label="Fechar"
                      >
                          <CloseIcon size={24} className="text-white md:w-7 md:h-7" />
                      </button>
                  </div>

                  <div className={`${bodyPadding} bg-white flex-grow flex flex-col overflow-y-auto`}>
                        {/* Cabeçalho dos dias da semana (DOM, SEG...)
                           NO MOBILE: Ocultamos (hidden) porque mudamos para lista vertical.
                           NO DESKTOP: Exibimos (md:grid)
                        */}
                        <div className={`hidden md:grid grid-cols-7 ${weekdayClass} shrink-0`}>
                          {['DOM', 'SEG', 'TER', 'QUA', 'QUI', 'SEX', 'SÁB'].map((d, i) => (
                              <div key={i} className="text-center font-bold text-slate-500 tracking-wider uppercase">
                                {d}
                              </div>
                          ))}
                        </div>

                        {/* Grade de Dias
                            NO MOBILE: grid-cols-1 (Uma coluna vertical, lista)
                            NO DESKTOP: md:grid-cols-7 (Grade de calendário normal)
                        */}
                        <div className={`grid grid-cols-1 md:grid-cols-7 gap-2 md:gap-3 flex-grow`}>
                          {weeks.flat().map((day, idx) => (
                              <ExpandedDayCard 
                                key={idx}
                                day={day}
                                monthIndex={monthIndex}
                                events={EVENTS}
                                themeColorClass={monthData.colorTheme}
                                isPdfMode={isPdfMode}
                              />
                          ))}
                        </div>
                  </div>
                </div>
            </Wrapper>
          );
        };

        const EventListTable = () => {
          const sortedEvents = useMemo(() => {
            return [...EVENTS].sort((a, b) => {
              if (a.month !== b.month) return a.month - b.month;
              return a.day - b.day;
            });
          }, []);

          return (
            <div className="mt-8 bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
              <div className="bg-slate-50 p-4 border-b border-slate-200 flex items-center gap-2">
                <CalendarDays className="text-blue-900 w-5 h-5" />
                <h3 className="font-bold text-slate-800 text-base md:text-lg">Cronograma Detalhado</h3>
              </div>
              
              <div className="overflow-x-auto w-full">
                <table className="w-full text-sm text-left border-collapse min-w-[600px]">
                  <thead>
                    <tr className="bg-slate-100 text-slate-600 border-b border-slate-200">
                      <th className="p-3 md:p-4 font-semibold text-xs uppercase tracking-wider">Mês</th>
                      <th className="p-3 md:p-4 font-semibold text-xs uppercase tracking-wider text-center">Data</th>
                      <th className="p-3 md:p-4 font-semibold text-xs uppercase tracking-wider">Evento</th>
                      <th className="p-3 md:p-4 font-semibold text-xs uppercase tracking-wider w-1/4">Categoria</th>
                    </tr>
                  </thead>
                  <tbody>
                    {sortedEvents.map((event, idx) => {
                      const weekDay = getWeekDayName(YEAR, event.month, event.day);
                      const legendLabel = getLegendLabel(event.type);
                      const showMonth = idx === 0 || sortedEvents[idx-1].month !== event.month;
                      const badgeStyle = getEventColorStyles(event.type);

                      return (
                        <tr key={idx} className="hover:bg-slate-50 transition-colors border-b border-slate-100 last:border-0 group">
                          <td className="p-3 md:p-4 align-top">
                            {showMonth && (
                              <span className="font-bold text-blue-900 bg-blue-50 px-2 py-1 rounded text-[10px] md:text-xs uppercase tracking-wide">
                                {MONTHS[event.month].name}
                              </span>
                            )}
                          </td>
                          <td className="p-3 md:p-4 align-top">
                            <div className="flex flex-col items-center justify-center bg-slate-100 rounded-lg p-1.5 w-12 md:w-14 border border-slate-200 group-hover:bg-white group-hover:shadow-sm transition-all">
                              <span className="text-base md:text-lg font-bold text-slate-700 leading-none">
                                {event.day < 10 ? `0${event.day}` : event.day}
                              </span>
                              <span className="text-[9px] md:text-[10px] text-slate-500 font-medium uppercase mt-0.5">
                                {weekDay.slice(0, 3)}
                              </span>
                            </div>
                          </td>
                          <td className="p-3 md:p-4 align-top text-slate-700 font-medium leading-relaxed text-xs md:text-sm">
                            {event.description}
                          </td>
                          <td className="p-3 md:p-4 align-top">
                            <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-[10px] md:text-xs font-medium ${badgeStyle} whitespace-nowrap`}>
                              {legendLabel}
                            </span>
                          </td>
                        </tr>
                      );
                    })}
                  </tbody>
                </table>
              </div>
            </div>
          );
        };

        const CreditsFooter = () => (
          <footer className="mt-12 py-6 border-t border-slate-300 text-center">
            <p className="text-xs text-slate-500 font-medium">
              {CREDITS_TEXT}
            </p>
          </footer>
        );

        // --- 4. APP PRINCIPAL ---

        function App() {
          const [expandedMonthIndex, setExpandedMonthIndex] = useState(null);
          const totalSchoolDays = 200; 

          // PDF Generation
          const [isGenerating, setIsGenerating] = useState(false);
          const [generationStep, setGenerationStep] = useState('idle');
          const [currentRenderMonth, setCurrentRenderMonth] = useState(0);
          const hiddenRenderRef = useRef(null);
          
          // Setup PDF Helper constants inside component or global
          const PDF_WIDTH = 297;
          const PDF_HEIGHT = 210;
          const CAPTURE_WIDTH = 1600; 

          const downloadOfflineHTML = () => {
            const htmlContent = document.documentElement.outerHTML;
            const blob = new Blob([htmlContent], { type: "text/html" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = `Calendario_Escolar_${YEAR}_Offline.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
          };

          const generateInteractivePDF = async () => {
            if (isGenerating) return;
            setIsGenerating(true);
            setGenerationStep('dashboard'); 
            
            await new Promise(r => setTimeout(r, 500)); 

            try {
              // Access jsPDF from global window
              const { jsPDF } = window.jspdf;
              const doc = new jsPDF('l', 'mm', 'a4'); 
              const stage = hiddenRenderRef.current;
              
              if (!stage) throw new Error("Capture stage not found");

              // PAGE 1: DASHBOARD
              const dashboardCanvas = await html2canvas(stage, {
                scale: 2, 
                useCORS: true,
                logging: false,
                backgroundColor: '#f0f4f8',
                windowWidth: CAPTURE_WIDTH,
                allowTaint: true, 
              });
              
              const imgData = dashboardCanvas.toDataURL('image/jpeg', 0.95);
              doc.addImage(imgData, 'JPEG', 0, 0, PDF_WIDTH, PDF_HEIGHT);

              // Add Credits to Page 1
              doc.setFontSize(8);
              doc.setTextColor(100);
              doc.text(CREDITS_TEXT, PDF_WIDTH / 2, PDF_HEIGHT - 5, { align: 'center' });

              // Links Page 1
              MONTHS.forEach((_, index) => {
                const cardEl = stage.querySelector(`#pdf-month-card-${index}`);
                if (cardEl) {
                  const rect = cardEl.getBoundingClientRect();
                  const containerRect = stage.getBoundingClientRect();
                  
                  const scaleX = PDF_WIDTH / containerRect.width;
                  const scaleY = PDF_HEIGHT / containerRect.height;
                  
                  const x = (rect.left - containerRect.left) * scaleX;
                  const y = (rect.top - containerRect.top) * scaleY;
                  const w = rect.width * scaleX;
                  const h = rect.height * scaleY;
                  doc.link(x, y, w, h, { pageNumber: index + 2 });
                }
              });

              // PAGES 2-13: MONTH DETAILS
              setGenerationStep('months');
              
              for (let i = 0; i < 12; i++) {
                setCurrentRenderMonth(i);
                await new Promise(r => setTimeout(r, 200));

                const monthCanvas = await html2canvas(stage, {
                  scale: 2, 
                  useCORS: true,
                  logging: false,
                  backgroundColor: '#ffffff',
                  windowWidth: CAPTURE_WIDTH,
                  allowTaint: true
                });

                doc.addPage();
                const monthImg = monthCanvas.toDataURL('image/jpeg', 0.95);
                doc.addImage(monthImg, 'JPEG', 0, 0, PDF_WIDTH, PDF_HEIGHT);
                
                // Add Credits to Month Pages
                doc.setFontSize(8);
                doc.setTextColor(100);
                doc.text(CREDITS_TEXT, PDF_WIDTH / 2, PDF_HEIGHT - 5, { align: 'center' });

                // Back Link
                doc.link(270, 12, 22, 22, { pageNumber: 1 });
              }

              doc.save(`Calendario_Escolar_${YEAR}.pdf`);

            } catch (error) {
              console.error("PDF Generation failed", error);
              alert("Houve um erro ao gerar o PDF. Verifique o console.");
            } finally {
              setIsGenerating(false);
              setGenerationStep('idle');
            }
          };

          return (
            <div id="main-calendar-top" className="min-h-screen bg-slate-50 flex flex-col print-exact pb-8 font-sans print:bg-white print:pb-0">
              
              {/* HIDDEN STAGE */}
              {isGenerating && (
                <div 
                    ref={hiddenRenderRef}
                    style={{
                      position: 'fixed',
                      left: '-10000px',
                      top: 0,
                      width: `${CAPTURE_WIDTH}px`,
                      minHeight: `${CAPTURE_WIDTH * 0.70}px`, 
                      zIndex: -1,
                      backgroundColor: generationStep === 'dashboard' ? '#f0f4f8' : '#ffffff', 
                    }}
                    className={generationStep === 'dashboard' ? "p-8 flex flex-col" : "p-8 flex items-center justify-center bg-white"}
                >
                    {generationStep === 'dashboard' ? (
                      <div className="flex flex-col h-full gap-8">
                          {/* Header PDF */}
                          <header 
                            style={{ background: 'linear-gradient(to bottom right, #1e3a8a, #1e40af, #312e81)' }}
                            className="text-white p-8 shadow-lg relative overflow-hidden shrink-0 rounded-3xl"
                          >
                            <div className="flex flex-row justify-between items-center relative z-10 gap-8">
                              <div className="flex flex-col items-start text-left">
                                <img 
                                  src={LOGO_URL} 
                                  alt="IDEP Rondônia" 
                                  className="h-24 mb-6 object-contain bg-white rounded-lg px-4 py-2 shadow-sm" 
                                />
                                
                                <h1 className="text-7xl font-black tracking-tight leading-none text-white">
                                  <span className="text-white inline-block">{YEAR}</span>
                                  <span className="font-light ml-6 text-white">Escolar</span>
                                </h1>
                              </div>
                              <div className="bg-white/10 backdrop-blur-md px-10 py-6 rounded-3xl border border-white/10">
                                  <p className="text-xl uppercase tracking-widest text-blue-200 mb-2">Ano Letivo</p>
                                  <div className="flex items-baseline gap-4 justify-end">
                                    <p className="text-6xl font-bold text-white">{totalSchoolDays}</p>
                                    <span className="text-3xl text-blue-200">Dias</span>
                                  </div>
                              </div>
                            </div>
                          </header>

                          {/* Grid PDF */}
                          <div className="grid grid-cols-4 gap-6 flex-grow" id="pdf-dashboard-grid">
                            {MONTHS.map((month, index) => (
                                <MonthCard 
                                  key={index}
                                  id={`pdf-month-card-${index}`} 
                                  monthIndex={index}
                                  monthData={month}
                                  onClick={() => {}}
                                  isPdfMode={true}
                                />
                            ))}
                          </div>
                          
                          {/* Legend PDF Footer */}
                          <div className="flex gap-6 justify-between pt-6 border-t border-slate-300 shrink-0">
                            {LEGEND_ITEMS.slice(0, 5).map((item, i) => (
                                <div key={i} className="flex items-center gap-3">
                                    <div className={`w-8 h-8 rounded-lg ${item.colorClass}`}></div>
                                    <span className="text-xl font-bold text-slate-600">{item.label}</span>
                                </div>
                            ))}
                          </div>
                      </div>
                    ) : (
                      // RENDER EXPANDED MONTH FOR PDF
                      <div className="w-full h-full flex items-center justify-center p-0">
                        <ExpandedMonthView 
                          monthIndex={currentRenderMonth}
                          monthData={MONTHS[currentRenderMonth]}
                          onClose={() => {}}
                          isPdfMode={true}
                        />
                      </div>
                    )}
                </div>
              )}

              {/* EXPANDED MONTH VIEW OVERLAY */}
              {expandedMonthIndex !== null && (
                <ExpandedMonthView 
                    monthIndex={expandedMonthIndex}
                    monthData={MONTHS[expandedMonthIndex]}
                    onClose={() => setExpandedMonthIndex(null)}
                />
              )}

              {/* MAIN SCREEN HEADER */}
              <header className="bg-gradient-to-br from-blue-900 via-blue-800 to-indigo-900 text-white p-6 md:p-8 shadow-lg relative overflow-hidden shrink-0">
                <div className="absolute top-0 right-0 w-96 h-96 bg-white opacity-[0.03] rounded-full blur-3xl transform translate-x-1/2 -translate-y-1/2 pointer-events-none"></div>
                <div className="absolute bottom-0 left-0 w-64 h-64 bg-blue-500 opacity-[0.05] rounded-full blur-2xl transform -translate-x-1/4 translate-y-1/4 pointer-events-none"></div>
                
                <div className="container mx-auto flex flex-col md:flex-row justify-between items-center relative z-10 gap-6">
                  <div className="flex flex-col items-center md:items-start text-center md:text-left">
                    <div className="bg-white/95 rounded-lg p-2 mb-4 shadow-sm inline-block">
                       <img 
                         src={LOGO_URL} 
                         alt="IDEP Rondônia" 
                         className="h-10 md:h-12 object-contain" 
                       />
                    </div>
                    
                    <h1 className="text-3xl md:text-6xl font-black tracking-tight leading-none">
                      <span className="text-white">{YEAR}</span>
                      <span className="font-light ml-3">Escolar</span>
                    </h1>
                    <p className="text-xs md:text-base font-medium mt-3 text-blue-100 max-w-md leading-relaxed">
                      Calendário oficial para Ensino Fundamental e Médio (Capital e Interior).
                    </p>
                  </div>
                  
                  <div className="flex flex-col md:flex-row items-center gap-4 mt-4 md:mt-0">
                     <button
                       onClick={downloadOfflineHTML}
                       className="bg-white/10 hover:bg-white/20 text-white px-5 py-3 rounded-xl backdrop-blur-md transition-all flex items-center gap-2 text-sm font-bold border border-white/20 shadow-lg h-14 hover:scale-105 active:scale-95 cursor-pointer"
                       title="Baixar aplicativo para uso Offline"
                     >
                       <FileCode size={20} />
                       <span className="hidden sm:inline">Baixar App Offline</span>
                       <span className="sm:hidden">Offline</span>
                     </button>

                     <button
                       onClick={generateInteractivePDF}
                       disabled={isGenerating}
                       className={`
                          bg-white/10 hover:bg-white/20 text-white px-5 py-3 rounded-xl backdrop-blur-md transition-all flex items-center gap-2 text-sm font-bold border border-white/20 shadow-lg h-14
                          ${isGenerating ? 'opacity-75 cursor-wait' : 'hover:scale-105 active:scale-95 cursor-pointer'}
                       `}
                       title="Salvar como PDF Interativo"
                     >
                       {isGenerating ? (
                         <>
                           <Loader2 size={20} className="animate-spin" />
                           <span className="hidden sm:inline">Gerando PDF...</span>
                         </>
                       ) : (
                         <>
                           <FileDown size={20} />
                           <span className="hidden sm:inline">Baixar PDF</span>
                           <span className="sm:hidden">PDF</span>
                         </>
                       )}
                     </button>

                     <div className="bg-blue-950/40 backdrop-blur-md px-6 py-2 rounded-xl border border-white/10 shadow-xl flex flex-col justify-center h-14 min-w-[140px]">
                        <p className="text-[10px] uppercase tracking-widest text-blue-200 mb-0.5 text-center">Ano Letivo</p>
                        <div className="flex items-baseline gap-1 justify-center">
                          <p className="text-2xl font-bold text-white">{totalSchoolDays}</p>
                          <span className="text-xs text-blue-200">Dias</span>
                        </div>
                     </div>
                  </div>
                </div>
              </header>

              {/* MAIN SCREEN BODY */}
              <div className="container mx-auto p-4 md:p-8 flex flex-col lg:flex-row gap-8 flex-grow items-start">
                
                {/* Main Calendar Grid (75%) */}
                <main className="flex-1 w-full lg:w-[75%] space-y-6 md:space-y-8">
                   <div className="flex items-center justify-between">
                      <p className="text-xs md:text-sm text-slate-500 flex items-center gap-2">
                        <Info size={16} />
                        Clique em um mês para expandir os detalhes.
                      </p>
                   </div>
                   
                   <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-6">
                     {MONTHS.map((month, index) => (
                       <MonthCard 
                         key={index} 
                         monthIndex={index} 
                         monthData={month}
                         onClick={() => setExpandedMonthIndex(index)}
                       />
                     ))}
                   </div>

                   <EventListTable />

                   <div className="pt-6 border-t border-slate-200 text-center text-[10px] md:text-xs text-slate-400 px-2 md:px-8 leading-relaxed">
                     CABE A CADA MUNICÍPIO OBSERVAR OS FERIADOS MUNICIPAIS E RELIGIOSOS COMPENSANDO EM DATA ESTABELECIDA PELA COORDENADORIA REGIONAL
                   </div>
                </main>

                {/* Sidebar (25%) */}
                <aside className="w-full lg:w-[25%] min-w-0 lg:min-w-[300px] shrink-0 flex flex-col gap-6 lg:sticky lg:top-6 static">
                   
                   {/* Mobile Stats Box */}
                   <div className="lg:hidden bg-gradient-to-br from-blue-50 to-white border border-blue-100 rounded-xl p-5 text-center shadow-sm">
                     <span className="block text-xs text-blue-400 uppercase tracking-widest font-semibold">Total de Dias Letivos</span>
                     <span className="block text-4xl font-black text-blue-900 my-2">{totalSchoolDays}</span>
                   </div>

                   {/* Legend Icons */}
                   <div className="bg-white p-5 rounded-xl shadow-sm border border-slate-200 ring-1 ring-slate-100">
                      <h3 className="text-slate-800 font-bold uppercase text-xs tracking-wider mb-5 flex items-center gap-2">
                        <TrendingUp size={16} className="text-blue-600" />
                        Legenda de Eventos
                      </h3>
                      <div className="flex flex-col gap-3.5">
                        {LEGEND_ITEMS.map((item, idx) => (
                          <div key={idx} className="flex items-start gap-3 group">
                            <div className={`w-7 h-7 rounded-lg shrink-0 flex items-center justify-center text-white shadow-sm ring-2 ring-white transition-transform group-hover:scale-110 ${item.colorClass}`}>
                              {item.icon && React.cloneElement(item.icon, { size: 14 })}
                            </div>
                            <span className="text-xs text-slate-600 font-medium leading-tight pt-1 group-hover:text-slate-900 transition-colors">
                              {item.label}
                            </span>
                          </div>
                        ))}
                      </div>
                   </div>

                   {/* Planning Card */}
                   <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden group">
                      <div className="bg-amber-50 px-5 py-3 border-b border-amber-100 flex items-center gap-2">
                         <div className="p-1 bg-amber-100 rounded text-amber-600"><Info size={14} /></div>
                         <h3 className="text-amber-900 font-bold text-xs md:text-sm uppercase tracking-wide">Planejamento</h3>
                      </div>
                      <div className="p-5">
                         <p className="text-xs md:text-sm text-slate-600 leading-relaxed">
                           A ser realizado nos dias de <strong>HTP</strong>, com entrega para a Equipe Pedagógica/Gestora até o <strong className="text-slate-800">5º dia útil</strong> que antecede o início dos bimestres.
                         </p>
                      </div>
                   </div>

                   {/* Evaluations Card */}
                   <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                      <div className="bg-slate-50 px-5 py-3 border-b border-slate-200 flex items-center gap-2">
                         <div className="p-1 bg-white border border-slate-200 rounded text-slate-500"><CalendarDays size={14} /></div>
                         <h3 className="text-slate-700 font-bold text-xs md:text-sm uppercase tracking-wide">Avaliações (Previsto)</h3>
                      </div>
                      <div className="p-2">
                        <ul className="flex flex-col gap-1">
                          {[
                            { bim: '1º Bimestre', date: 'Abril' },
                            { bim: '2º Bimestre', date: 'Julho' },
                            { bim: '3º Bimestre', date: 'Setembro' },
                            { bim: '4º Bimestre', date: 'Dezembro' },
                          ].map((item, i) => (
                            <li key={i} className="flex justify-between items-center p-2.5 hover:bg-slate-50 rounded-lg text-sm transition-colors border-b border-slate-50 last:border-0">
                              <span className="font-semibold text-slate-700 text-xs md:text-sm">{item.bim}</span>
                              <span className="text-slate-500 bg-slate-100 px-2 py-0.5 rounded text-[10px] md:text-xs">{item.date}</span>
                            </li>
                          ))}
                        </ul>
                      </div>
                   </div>

                   {/* Warning Card */}
                   <div className="bg-red-50 rounded-xl border border-red-100 p-5 shadow-sm relative overflow-hidden">
                      <div className="absolute top-0 right-0 p-4 opacity-10">
                         <AlertTriangle size={64} className="text-red-500" />
                      </div>
                      <div className="relative z-10">
                         <div className="flex items-center gap-2 mb-2 text-red-700">
                            <AlertTriangle size={18} />
                            <h4 className="font-bold text-xs uppercase tracking-wider">Atenção Professor</h4>
                         </div>
                         <p className="text-xs text-red-800/80 leading-relaxed font-medium">
                            O <strong>Diário Digital</strong> não permitirá o lançamento no Bimestre em curso se não houver pelo menos <strong>75% de frequência e conteúdo</strong> lançados no Bimestre anterior.
                         </p>
                      </div>
                  </div>

                </aside>
              </div>
              
              <CreditsFooter />
            </div>
          );
        }

        // --- 5. RENDERIZAÇÃO ---
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
      })(); // End IIFE
    </script>
  </body>
</html>
